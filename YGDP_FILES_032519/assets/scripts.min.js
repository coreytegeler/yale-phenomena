$(function(){var e,t,a,r,n,i,s,o,l,d,p,u,c,f,m,v,h,g,y,b,x,C,w,j,k,q,S,T,I,O,L,z,N,E,M,R,_,G,H,J,F,P,Y,U,A,D,B,Z,W,X,K,Q,V,ee,te,ae;return e=$("body"),i=$("#map"),a=$("#filters"),s=$("#phenomena"),$("#creation"),t=$("#embedder"),r=$("header.fixed"),n=$("header.fixed .sentence"),"pk.eyJ1IjoieWdkcCIsImEiOiJjamY5bXU1YzgyOHdtMnhwNDljdTkzZjluIn0.YS8NHwrTLvUlZmE8WEEJPg","mapbox://styles/ygdp/cjl7azzlm04592so27jav5xlw","prod","./assets/data/",39.6,-99.4,3.4,0,24,1,5,window.query={map:{lat:39.6,lng:-99.4,zoom:3.4}},window.phen={},j=function(e){var t;return t="https://ygdp.yale.edu/maps/json",$.ajax({type:"GET",contentType:"application/json",dataType:"json",url:t,success:function(e,t,a){return G(e)},error:function(e){return console.log(e)}})},x=function(e){var t;return t="https://ygdp.yale.edu/maps/json/"+e,$.ajax({type:"GET",contentType:"application/json",dataType:"json",url:t,success:function(e,t,a){var r;if(r=e[0],window.map=r)return I()},error:function(e){return console.log(e)}})},o=function(e){return $("header .phenomenon").each(function(){return this.innerHTML=g(e)})},G=function(e){var t,a,r,n;for(t=0,a=e.length;t<a;t++){if(!(r=e[t]).show||!parseInt(r.show))return;(n=$("<option></option>")).text(g(r.title)),n.val(r.id),$('select[name="id"]').append(n)}},I=function(){var e,t,a,r,n,i;if(i=window.map.sentences){for(r=[],e=t=0,a=(i=i.split(",")).length;t<a;e=++t)n=i[e],r.push(T(n,e));return r}},T=function(e,t){var a;return a="https://ygdp.yale.edu/sentences/json/"+e,$.ajax({type:"GET",contentType:"application/json",dataType:"json",url:a,success:function(e,a,r){return H(e[0],t)},error:function(e){return console.log(e)}})},H=function(e,t){var r,n,i;return n=s.find("ul"),r=$("<li></li>").addClass("sentence option").attr("data-val",e.sentence_id).attr("data-phen-title",e.phenomenon_title).attr("data-phen-id",e.phenomenon_id).attr("data-phen-index",t).html("<span>"+e.title+"</span>"),(i=n.find('li[data-phen-index="'+(t-1)+'"]')).length?i.after(r):n.append(r),a.find(".fieldset.accept ul").append(r.clone()),a.find(".fieldset.reject ul").append(r.clone())},J=function(e){var t;return e.preventDefault(),t=$("form").serializeArray(),{},$.each(t,function(){var e,t,a;return e=(a=this.name.split("."))[0],t=a[1],query.map[e]||(query.map[e]={}),t?query.map[e][t]=this.value:query.map[e]=parseFloat(this.value)}),W(),h()},h=function(){var t;return U(),x(query.map.id),e.removeClass("form").addClass("map"),mapboxgl.accessToken="pk.eyJ1IjoieWdkcCIsImEiOiJjamY5bXU1YzgyOHdtMnhwNDljdTkzZjluIn0.YS8NHwrTLvUlZmE8WEEJPg",window.mapbox=new mapboxgl.Map({container:"map",style:"mapbox://styles/ygdp/cjl7azzlm04592so27jav5xlw",zoom:query.map.zoom}),query.map.lng&&query.map.lat&&(t=new mapboxgl.LngLat(query.map.lng,query.map.lat),mapbox.setCenter(t)),mapbox.on("load",M)},M=function(){var e;if(map&&map.geojson)return e=Math.floor(Date.now()/1e3),mapbox.addSource("markers",{type:"geojson",data:map.geojson+"?version="+e}),mapbox.addLayer({id:"markers",type:"symbol",source:"markers",layout:{"icon-image":"marker","icon-allow-overlap":!0,"icon-size":{base:.9,stops:[[0,.2],[16,1.4]]}}}),window.popup=new mapboxgl.Popup({closeButton:!1,closeOnClick:!1}),X(),b()},ee=function(e){var t;if((t=$(this).parents("aside")).toggleClass("closed"),t.is("#phenomena"))return r.toggleClass("hide")},v=function(e){var t;return t=$(this).attr("data-val"),Y(t),W()},Y=function(e){var t,r,i,l,d,p;if(l=(i=s.find('.option[data-val="'+e+'"]')).parents(".fieldset").parents("aside"),t=a.find(".fieldset.accepted"),r=a.find(".label.accepted"),i.length)return i.is(".selected")?(i.removeClass("selected"),t.addClass("disabled"),d=null,p=null,e=null):(l.find(".selected").removeClass("selected"),i.addClass("selected"),t.removeClass("disabled"),d=i.attr("data-phen-title"),p=i.find("span").text()),o(d),n.text(p),t.attr("data-prop",e),r.attr("data-prop",e),l.attr("data-selected",e),ae();ae()},f=function(e){var t,a,r,n;return a=$(this),!$(e.target).is(".inputs, .inputs *")&&((t=a.parents(".fieldset")).parents("aside"),r=t.attr("data-prop-slug")||t.attr("data-prop"),n=a.attr("data-val-slug")||a.attr("data-val"),F(r,n),W())},m=function(e){return a.find(".fieldset").each(function(e,t){var a;return a=$(t).data("prop-slug"),F(a),$(t).find(".slider")&&D(a),$(t).removeClass("open")})},F=function(e,t){var a,r,n,i;if(t=z(e,t),["accept","reject"].includes(t)?(a=y(t),r=k(t,e)):(a=y(e),r=k(e,t)),a.addClass("open"),i=a.find(".selected"),n=a.find(".options"),r&&r.length)return r.is(".selected:not(.all)")?(r.removeClass("selected"),n.find(".selected").length||a.find(".all").addClass("selected")):r.addClass("selected"),r.is(".all")?i.filter(":not(.all)").removeClass("selected"):a.is(".radio")?i.removeClass("selected"):i.filter(".all").removeClass("selected"),a.is(".layers")?V(t):A()},D=function(e,t){var a,r;return r=(a=y(e)).find(".slider"),a.addClass("open"),t&&2===t.length||(t=[1,100]),r.slider("values",t)},y=function(e){var t,r;return e=q(e),(t=a.find('.fieldset[data-prop="'+e+'"]')).length||(r=S(e),t=a.find('.fieldset[data-prop-slug="'+r+'"]')),t},k=function(e,t){var a,r,n;return a=y(e),t?(t=L(e,t),(r=a.find('.option[data-val="'+t+'"]')).length?r:(n=z(e,t),(r=a.find('.option[data-val-slug="'+n+'"]')).length?r:void 0)):a.find(".option.all")},Q=function(e){var t,r,n;return r=$(this),a=r.parents("#filters"),r.is(".active")?(r.removeClass("active"),a.toggleClass("closed")):(a.removeClass("closed"),n=r.attr("data-form"),t=$('.form[data-form="'+n+'"]'),$(".tab.active").removeClass("active"),$(".form.active").removeClass("active"),r.addClass("active"),t.addClass("active"))},K=function(e){return $(this).parents(".fieldset").toggleClass("open")},P=function(e){var t,a;if(!(t=$(this)).is(".selected"))return a=t.attr("data-prop-slug"),_(a)},_=function(e){var t,a,r,n,i;if((n=$('.multi-field[data-prop="'+e+'"]')).length)return(r=(a=n.parents(".fieldset")).find('.multi-label[data-prop-slug="'+e+'"]')).attr("data-prop"),a=r.parents(".fieldset"),i=r.attr("data-prop"),r.siblings().removeClass("selected"),r.addClass("selected"),(t=a.find('[data-prop="'+e+'"]')).siblings().removeClass("open").addClass("disabled"),t.addClass("open").removeClass("disabled"),a.attr("data-prop",i),a.attr("data-prop-slug",e),A(),W()},A=function(){var e,t,r,n,i,s,o,l,d,p,u,f,m,v,h,g,y;if(y={},a.find(".filter li.selected").each(function(e,t){var a,r,n;if(!$(t).parents(".disabled").length&&(n=$(t).parents(".filter").attr("data-prop"),r=$(t).attr("data-val")))return a=$(t).parents(".filter").attr("data-prop"),y[a]?y[a].push(r):y[a]=[r],c(n)}),o)o=c(prop);else for(o=["all"],"in",l=0,p=(g=Object.keys(y)).length;l<p;l++)if(n=g[l],i=y[n],n.indexOf("_")>-1&&i[0]&&"Age_Bin"!==n&&(i=i[0].split(",")),["accept","reject"].includes(n))for(d=0,u=i.length;d<u;d++){for(s=["in",t=i[d]],v=0,f=(r=O(n).split(",")).length;v<f;v++)e=r[v],s.push(parseInt(e));o.push(s)}else{for(s=["in",n],h=0,m=i.length;h<m;h++)t=i[h],Number.isInteger(parseInt(t))&&t.indexOf("-")<0&&(t=parseInt(t)),s.push(t);o.push(s)}if(a.find(".slider").each(function(e,t){var a,r,n,i;if(!(a=$(t)).parents(".disabled").length)if(a.find(".ui-slider-handle"),r=a.parents(".fieldset").attr("data-prop"),"","scale"===(n=a.attr("data-type"))){if(i=a.attr("data-val"))return o.push(["==",r,i]),"("+i+")"}else if("range"===n&&(y=a.slider("values")).length)return a.attr("data-val",y.join(",")),o.push([">=",r,y[0]]),o.push(["<=",r,y[1]])}),mapbox.getLayer("markers"))return mapbox.setFilter("markers",o)},c=function(e){var t,a,r,n,i;if(mapbox.length&&(a=mapbox.getFilter("markers"))){for((t=a.slice(0)).shift(),r=n=0,i=t.length;n<i;r=++n)t[r].indexOf(e)>-1&&a.splice(r+1);return a}},V=function(e){if(mapbox.getLayer(e))return"visible"===mapbox.getLayoutProperty(e,"visibility")?mapbox.setLayoutProperty(e,"visibility","none"):mapbox.setLayoutProperty(e,"visibility","visible")},Z=function(){return $(".slider").each(function(e,t){var a,r,n,i,s,o,l;if(l=(r=$(t)).attr("data-type"),s=Number(r.attr("data-min")),n=Number(r.attr("data-max")),i=Number(((s+n)/2).toFixed(0)),o={min:s,max:n,range:"range"===l},"scale"===l?o.value=i:"range"===l&&(o.values=[s,n]),r.slider(o),"range"===l)return(a=r.find(".ui-slider-handle")).first().attr("data-val",s),a.last().attr("data-val",n)})},p=function(e,t){var a,r,n,i,s;if("range"===(r=$(this)).attr("data-type"))return i=(s=t.values)[0],n=s[1],r.attr("data-min",i),r.attr("data-max",n),(a=r.find(".ui-slider-handle")).first().attr("data-val",i),a.last().attr("data-val",n)},l=function(e,t){var a,r,n,i,s,o,l;return(r=$(this)).parents(".fieldset").attr("data-prop-slug"),"scale"===(s=r.attr("data-type"))?(o=t.value.toString(),r.attr("data-val",o)):"range"===s&&(i=(l=t.values)[0],n=l[1],r.attr("data-min",i),r.attr("data-max",n),(a=r.find(".ui-slider-handle")).first().attr("data-val",i),a.last().attr("data-val",n),o=[i,n].join(","),r.attr("data-val",o),r.attr("data-val-slug",o)),A(),W()},R=function(e){var t,a;return t=$(this).parents(".option"),(a=parseInt(this.value))?a<1?a=1:a>5&&(a=5):a=t.is(".accept")?5:1,$(this).val(a)},d=function(e){var t,a,r,n,i,s,o,l,d,p,u,c,f;return s=(n=$(this)).siblings("input"),r=(i=n.parents(".option")).siblings(".option.range-input"),f=parseInt(n.val()),c=i.attr("data-type"),u=s.val(),n.is(".min")&&f>u?s.val(f):n.is(".max")&&f<u&&s.val(f),f>5?f=5:f<1&&(f=1),n.val(f),a=r.find(".min"),t=r.find(".max"),l=parseInt(a.val()),o=parseInt(t.val()),"accept"===c&&f<=o?((d=f-1)<t.val()&&d++,d===o&&(d=f-1),d<1&&(d=1),t.val(d),d<l&&a.val(d)):"reject"===c&&f>=l&&((p=f+1)>a.val()&&p--,p===l&&(p=f+1),p>5&&(d=5),a.val(p),p>o&&t.val(p)),B(i),B(r),ae(),A(),W()},B=function(e){var t,a,r,n,i,s;for(r=[],t=a=i=e.find("input.min").val(),s=e.find("input.max").val();i<=s?a<=s:a>=s;t=i<=s?++a:--a)r.push(Math.abs(t));return n=JSON.stringify(r).replace(/[\[\]']+/g,""),e.attr("data-val",n)},O=function(e){var t;if("accept"===e)t=a.find(".option.accept");else{if("reject"!==e)return(t=a.find('.option[data-val="'+e+'"]')).length?t.attr("data-type"):null;t=a.find(".option.reject")}return t.attr("data-val")},E=function(e){return $(this).parents(".option").addClass("no-hover")},te=function(e){return $(this).parents(".option").removeClass("no-hover")},ae=function(){var e,t,a,r,n,i,s,o,l;if(i=$(".fieldset.phenomena .sentence.selected").attr("data-val")){for(t=$(".option.accept").attr("data-val"),e=JSON.parse("["+t+"]"),l=$(".option.reject").attr("data-val"),o=JSON.parse("["+l+"]"),s=[],a=r=1,5;r<=5;a=++r)e.indexOf(a)>-1?s.push([a,"marker-accepted"]):o.indexOf(a)>-1?s.push([a,"marker-rejected"]):s.push([a,""]);n={property:i,type:"categorical",stops:s}}else n="marker";if(mapbox.getLayer("markers"))return mapbox.setLayoutProperty("markers","icon-image",n)},C=function(){var e,t,a,r,n,i,s,o,l,d,p,u;if(n={},s=window.location.search.substring(1)){for(l=[],t=a=0,r=(o=(s=decodeURIComponent(s)).split("&")).length;a<r;t=++a)e=(u=(i=o[t].split("="))[0].split("."))[1],p=u[2],d=i[1],"map"===u[0]?(n[e]||(query.map[e]={}),p?l.push(query.map[e][p]=d):l.push(query.map[e]=parseFloat(d))):l.push(void 0);return l}},W=function(){var e,t,a,r,n,o,l,d,p,u,c,f,m,v,h,g,y,b,x,C,w,j;for(f=window.query.map,e=s.find(".sentence.selected"),o=0,p=(y=Object.keys(window.query)).length;o<p;o++)l=y[o],["map"].indexOf(l)<0&&delete window.query[l];if(e.length&&(C=e.attr("data-val"),query.s=C),i.is(".mapboxgl-map")&&(a=mapbox.getFilter("markers")))for(r=d=1,b=a.length-1;1<=b?d<=b:d>=b;r=1<=b?++d:--d)if((t=a[r])&&"all"!==t){for(m=S(t[1]),g=[],n=c=2,x=t.length-1;2<=x?c<=x:c>=x;n=2<=x?++c:--c)h=z(m,t[n]),g.push(h);j=g.join(),query[m]?query[m]=query[m]+","+j:query[m]=j}return window.query=Object.assign({map:f},query),v=(v=$.param(window.query)).replace(/\%5B/g,".").replace(/%5D/g,""),w=(u=window.location).origin+u.pathname,a&&(w=w.replace(u.search,"")),w+="?"+v,w=decodeURIComponent(w),history.pushState(g,"",w),U()},U=function(){var e;return e='<iframe width="100%" height="500px" src="'+window.location+'"></iframe>',t.find("textarea").html(e)},w=function(){return C(),query.map&&query.map.id?h():e.addClass("form")},b=function(){var e,t,a,r,n,i,s,o,l,d;if(i=window.location.search.substring(1)){for(!1,o=[],e=t=0,a=(s=(i=decodeURIComponent(i)).split("&")).length;t<a;e=++t)r=s[e].split("="),n=r[0],d=r[1],"s"===n&&(!0,Y(d)),_(n),"show"===n&&F(n,d),d=n.indexOf("_")<0?d.split(","):[O(d)],"age"===n?o.push(D(n,d)):"s"!==n?o.push(function(){var e,t,a;for(a=[],e=0,t=d.length;e<t;e++)l=d[e],a.push(F(n,l));return a}()):o.push(void 0);return o}},N=function(e){var t,r,n,i,o,l,d,p,c,f,m,v,h,g,y;for(v=s.attr("data-selected"),mapbox.getCanvas().style.cursor="pointer",y=(m=(d=e.features[0]).properties)[v],r=a.find(".option.accept").attr("data-val"),h=a.find(".option.reject").attr("data-val"),n=r.indexOf(y)>-1?"#5fa990":h.indexOf(y)>-1?"#795292":"#153554",g="<ul>",i=o=0,l=(c=["Age","Gender","Education","Race","Place Raised","Currently Lives","Mother/Guardian 1 Raised","Father/Guardian 2 Raised","Survey Type","Survey Year"]).length;o<l;i=++o)(f=m[u(p=c[i])])&&"NA"!==f&&(g+="<li>"+p+": "+u(f)+"</li>",i>c.length-1&&(description+="</ul>"));return popup.setLngLat(d.geometry.coordinates).setHTML(g).addTo(mapbox),(t=$(popup._content)).parent().addClass("show").attr("data-id",Date.now()),t.css("background",n)},u=function(e){var t;return(t={No_HS_diploma:"Some high school",HS_diploma:"High school",No_degree:"Some college",Associates:"Associate's degree",Bachelors:"Bachelor's degree",Graduate:"Graduate degree","Place Raised":"Raised.CityState","Currently Lives":"Current.CityState","Mother/Guardian 1 Raised":"Mother.CityState","Father/Guardian 2 Raised":"Father.CityState","Survey Type":"SurveyType","Survey Year":"SurveyYear"})[e]?t[e]:e},X=function(){return mapbox.on("moveend",function(e){var t;return t=mapbox.getCenter(),query.map.zoom=mapbox.getZoom(),query.map.lng=t.lng,query.map.lat=t.lat,W()}),mapbox.on("mouseenter","markers",N),mapbox.on("mouseleave","markers",function(e){var t,a;return t=$(".mapboxgl-popup"),a=t.attr("data-id"),setTimeout(function(){var e;if(e=t.attr("data-id"),a===e)return t.removeClass("show")},500)})},q=function(e){var t,a;return(t=$('.fieldset[data-prop-slug="'+e+'"]'))&&(a=t.attr("data-prop"))?a:e},S=function(e){var t,a;return(t=$('.fieldset[data-prop="'+e+'"]'))&&(a=t.attr("data-prop-slug"))?a:e},L=function(e,t){var a,r,n;return e=q(e),(a=$('.fieldset[data-prop="'+e+'"]')).find(".slider").length?t:((r=a.find('.option[data-val-slug="'+t+'"]'))&&r.length||(r=a.find('.slider[data-val-slug="'+t+'"]')),r.length&&(n=r.attr("data-val")).length?n:t)},z=function(e,t){var a,r,n;return e=S(e),(a=$('.fieldset[data-prop-slug="'+e+'"]')).find(".slider").length?t:(r=a.find('.option[data-val="'+t+'"]')).length&&(n=r.attr("data-val-slug")||r.attr("data-val"))&&n.length?n:t},g=function(e){var t;return(t=document.createElement("textarea")).innerHTML=e,t.value},j(),w(),Z(),new ClipboardJS(".instruct, #embed"),$("body").on("click","aside .label",K),$("body").on("click","aside .multi-label",P),$("body").on("click","aside#filters .option",f),$("body").on("click","aside#filters .reset .label",m),$(".slider").on("slidechange",l),$(".slider").on("slide",p),$(".range-input input").on("keyup",R),$(".range-input input").on("change",d),$(".range-input .inputs").on("mouseenter",E),$(".range-input .inputs").on("mouseleave",te),$("body").on("click","aside .close",ee),$("body").on("click","aside#phenomena ul li",v),$("body").on("click","aside#filters .tab",Q),$("body").on("submit","#creation form",J)});