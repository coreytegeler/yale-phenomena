$(function(){var e,a,t,n,r,i,s,o,l,d,p,u,c,f,m,v,g,h,y,b,x,C,w,j,k,q,L,I,O,T,S,N,z,A,E,H,M,R,_,G,J,F,P,B,U,D,W,Y,Z,X,K,Q,V;return e=$("body"),i=$("#map"),t=$("#filters"),s=$("#phenomena"),$("#creation"),a=$("#embedder"),n=$("header.fixed"),r=$("header.fixed .sentence"),"pk.eyJ1IjoieWdkcCIsImEiOiJjamY5bXU1YzgyOHdtMnhwNDljdTkzZjluIn0.YS8NHwrTLvUlZmE8WEEJPg","mapbox://styles/ygdp/cjl7azzlm04592so27jav5xlw","prod","./assets/data/",39.6,-99.4,3.4,0,24,1,5,window.query={map:{lat:39.6,lng:-99.4,zoom:3.4}},window.phen={},x=function(e){var a;return a="https://ygdp.yale.edu/maps/json",$.ajax({type:"GET",contentType:"application/json",dataType:"json",url:a,success:function(e,a,t){return E(e)},error:function(e){return console.log(e)}})},h=function(e){var a;return a="https://ygdp.yale.edu/maps/json/"+e,$.ajax({type:"GET",contentType:"application/json",dataType:"json",url:a,success:function(e,a,t){var n;if(n=e[0],window.map=n)return q()},error:function(e){return console.log(e)}})},o=function(e){return $("header .phenomenon").each(function(){var a;return(a=document.createElement("textarea")).innerHTML=e,this.innerHTML=a.value})},E=function(e){var a,t,n,r,i;for(i=[],a=0,t=e.length;a<t;a++)n=e[a],(r=$("<option></option>")).text(n.title.replace(/(<([^>]+)>)/gi,"")),r.val(n.id),i.push($('select[name="id"]').append(r));return i},q=function(){var e,a,t,n,r;if(r=window.map.sentences){for(t=[],e=0,a=(r=r.split(",")).length;e<a;e++)n=r[e],t.push(k(n));return t}},k=function(e){var a;return a="https://ygdp.yale.edu/sentences/json/"+e,$.ajax({type:"GET",contentType:"application/json",dataType:"json",url:a,success:function(e,a,t){return H(e)},error:function(e){return console.log(e)}})},H=function(e){var a,n;return n=s.find("ul"),a=$("<li></li>").addClass("sentence").attr("data-val",e.sentence_id).attr("data-phen-title",e.phenomenon_title).attr("data-phen-id",e.phenomenon_id).html("<span>"+e.title+"</span>"),n.append(a.addClass("option")),t.find(".fieldset.accept ul").append(a.clone()),t.find(".fieldset.reject ul").append(a.clone())},M=function(e){var a;return e.preventDefault(),a=$("form").serializeArray(),{},$.each(a,function(){var e,a,t;return e=(t=this.name.split("."))[0],a=t[1],query.map[e]||(query.map[e]={}),a?query.map[e][a]=this.value:query.map[e]=parseFloat(this.value)}),D(),m()},m=function(){var a;return J(),h(query.map.id),e.removeClass("form").addClass("map"),mapboxgl.accessToken="pk.eyJ1IjoieWdkcCIsImEiOiJjamY5bXU1YzgyOHdtMnhwNDljdTkzZjluIn0.YS8NHwrTLvUlZmE8WEEJPg",window.mapbox=new mapboxgl.Map({container:"map",style:"mapbox://styles/ygdp/cjl7azzlm04592so27jav5xlw",zoom:query.map.zoom}),query.map.lng&&query.map.lat&&(a=new mapboxgl.LngLat(query.map.lng,query.map.lat),mapbox.setCenter(a)),mapbox.on("load",N)},N=function(){var e;if(map&&map.geojson)return e=Math.floor(Date.now()/1e3),mapbox.addSource("markers",{type:"geojson",data:map.geojson+"?version="+e}),mapbox.addLayer({id:"markers",type:"symbol",source:"markers",layout:{"icon-image":"marker","icon-allow-overlap":!0,"icon-size":{base:.9,stops:[[0,.2],[16,1.4]]}}}),window.popup=new mapboxgl.Popup({closeButton:!1,closeOnClick:!1}),W(),g()},K=function(e){var a;if((a=$(this).parents("aside")).toggleClass("closed"),a.is("#phenomena"))return n.toggleClass("hide")},f=function(e){var a;return a=$(this).attr("data-val"),G(a),D()},G=function(e){var a,n,i,l,d,p;if((i=s.find('.option[data-val="'+e+'"]')).length||(e=(i=s.find(".sentence").first()).attr("data-val")),i.length)return d=i.attr("data-phen-title"),i.attr("data-phen-id"),o(d),l=i.parents(".fieldset").parents("aside"),p=i.find("span").text(),l.find(".selected").removeClass("selected"),i.toggleClass("selected"),a=t.find(".fieldset.accepted"),n=t.find(".label.accepted"),a.attr("data-prop",e),n.attr("data-prop",e),l.attr("data-selected",e),i.is(".selected")?(r.text(p),V(),a.removeClass("disabled")):(r.text(""),a.addClass("disabled"));V()},c=function(e){var a,t,n,r;return t=$(this),!$(e.target).is(".inputs, .inputs *")&&((a=t.parents(".fieldset")).parents("aside"),n=a.attr("data-prop-slug")||a.attr("data-prop"),r=t.attr("data-val-slug")||t.attr("data-val"),R(n,r),D())},R=function(e,a){var t,n,r,i;if(a=O(e,a),["accept","reject"].includes(a)?(t=v(a),n=C(a,e)):(t=v(e),n=C(e,a)),t.addClass("open"),i=t.find(".selected"),r=t.find(".options"),n&&n.length)return n.is(".selected:not(.all)")?(n.removeClass("selected"),r.find(".selected").length||t.find(".all").addClass("selected")):n.addClass("selected"),n.is(".all")?i.filter(":not(.all)").removeClass("selected"):t.is(".radio")?i.removeClass("selected"):i.filter(".all").removeClass("selected"),t.is(".layers")?X(a):F()},P=function(e,a){var t,n;return n=(t=v(e)).find(".slider"),t.addClass("open"),2!==a.length&&(a=[1,100]),n.slider("values",a)},v=function(e){var a,n;return e=w(e),(a=t.find('.fieldset[data-prop="'+e+'"]')).length||(n=j(e),a=t.find('.fieldset[data-prop-slug="'+n+'"]')),a},C=function(e,a){var t,n,r;return t=v(e),a?(a=I(e,a),(n=t.find('.option[data-val="'+a+'"]')).length?n:(r=O(e,a),(n=t.find('.option[data-val-slug="'+r+'"]')).length?n:void 0)):t.find(".option.all")},Z=function(e){var a,n,r;return n=$(this),t=n.parents("#filters"),n.is(".active")?(n.removeClass("active"),t.toggleClass("closed")):(t.removeClass("closed"),r=n.attr("data-form"),a=$('.form[data-form="'+r+'"]'),$(".tab.active").removeClass("active"),$(".form.active").removeClass("active"),n.addClass("active"),a.addClass("active"))},Y=function(e){return $(this).parents(".fieldset").toggleClass("open")},_=function(e){var a,t;if(!(a=$(this)).is(".selected"))return t=a.attr("data-prop-slug"),A(t)},A=function(e){var a,t,n,r,i;if((r=$('.multi-field[data-prop="'+e+'"]')).length)return(n=(t=r.parents(".fieldset")).find('.multi-label[data-prop-slug="'+e+'"]')).attr("data-prop"),t=n.parents(".fieldset"),i=n.attr("data-prop"),n.siblings().removeClass("selected"),n.addClass("selected"),(a=t.find('[data-prop="'+e+'"]')).siblings().removeClass("open").addClass("disabled"),a.addClass("open").removeClass("disabled"),t.attr("data-prop",i),t.attr("data-prop-slug",e),F(),D()},F=function(){var e,a,n,r,i,s,o,l,d,p,c,f,m,v,g,h,y;if(y={},t.find(".filter li.selected").each(function(e,a){var t,n,r;if(!$(a).parents(".disabled").length&&(r=$(a).parents(".filter").attr("data-prop"),n=$(a).attr("data-val")))return t=$(a).parents(".filter").attr("data-prop"),y[t]?y[t].push(n):y[t]=[n],u(r)}),o)o=u(prop);else for(o=["all"],"in",l=0,p=(h=Object.keys(y)).length;l<p;l++)if(r=h[l],i=y[r],r.indexOf("_")>-1&&i[0]&&"Age_Bin"!==r&&(i=i[0].split(",")),["accept","reject"].includes(r))for(d=0,c=i.length;d<c;d++){for(s=["in",a=i[d]],v=0,f=(n=L(r).split(",")).length;v<f;v++)e=n[v],s.push(parseInt(e));o.push(s)}else{for(s=["in",r],g=0,m=i.length;g<m;g++)a=i[g],Number.isInteger(parseInt(a))&&a.indexOf("-")<0&&(a=parseInt(a)),s.push(a);o.push(s)}if(t.find(".slider").each(function(e,a){var t,n,r,i;if(!(t=$(a)).parents(".disabled").length)if(t.find(".ui-slider-handle"),n=t.parents(".fieldset").attr("data-prop"),"","scale"===(r=t.attr("data-type"))){if(i=t.attr("data-val"))return o.push(["==",n,i]),"("+i+")"}else if("range"===r&&(y=t.slider("values")).length)return t.attr("data-val",y.join(",")),o.push([">=",n,y[0]]),o.push(["<=",n,y[1]])}),mapbox.getLayer("markers"))return mapbox.setFilter("markers",o)},u=function(e){var a,t,n,r,i;if(mapbox.length&&(t=mapbox.getFilter("markers"))){for((a=t.slice(0)).shift(),n=r=0,i=a.length;r<i;n=++r)a[n].indexOf(e)>-1&&t.splice(n+1);return t}},X=function(e){if(mapbox.getLayer(e))return"visible"===mapbox.getLayoutProperty(e,"visibility")?mapbox.setLayoutProperty(e,"visibility","none"):mapbox.setLayoutProperty(e,"visibility","visible")},U=function(){return $(".slider").each(function(e,a){var t,n,r,i,s,o,l;if(l=(n=$(a)).attr("data-type"),s=Number(n.attr("data-min")),r=Number(n.attr("data-max")),i=Number(((s+r)/2).toFixed(0)),o={min:s,max:r,range:"range"===l},"scale"===l?o.value=i:"range"===l&&(o.values=[s,r]),n.slider(o),"range"===l)return(t=n.find(".ui-slider-handle")).first().attr("data-val",s),t.last().attr("data-val",r)})},l=function(e,a){var t,n,r,i,s,o,l;return(n=$(this)).parents(".fieldset").attr("data-prop-slug"),"scale"===(s=n.attr("data-type"))?(o=a.value.toString(),n.attr("data-val",o)):"range"===s&&(i=(l=a.values)[0],r=l[1],n.attr("data-min",i),n.attr("data-max",r),(t=n.find(".ui-slider-handle")).first().attr("data-val",i),t.last().attr("data-val",r),o=[i,r].join(","),n.attr("data-val",o),n.attr("data-val-slug",o)),F(),D()},z=function(e){var a,t;return a=$(this).parents(".option"),(t=parseInt(this.value))?t<1?t=1:t>5&&(t=5):t=a.is(".accept")?5:1,$(this).val(t)},d=function(e){var a,t,n,r,i,s,o,l,d,p,u,c,f;return s=(r=$(this)).siblings("input"),n=(i=r.parents(".option")).siblings(".option.range-input"),f=parseInt(r.val()),c=i.attr("data-type"),u=s.val(),r.is(".min")&&f>u?s.val(f):r.is(".max")&&f<u&&s.val(f),f>5?f=5:f<1&&(f=1),r.val(f),t=n.find(".min"),a=n.find(".max"),l=parseInt(t.val()),o=parseInt(a.val()),"accept"===c&&f<=o?((d=f-1)<a.val()&&d++,d===o&&(d=f-1),d<1&&(d=1),a.val(d),d<l&&t.val(d)):"reject"===c&&f>=l&&((p=f+1)>t.val()&&p--,p===l&&(p=f+1),p>5&&(d=5),t.val(p),p>o&&a.val(p)),B(i),B(n),V(),F(),D()},B=function(e){var a,t,n,r,i,s;for(n=[],a=t=i=e.find("input.min").val(),s=e.find("input.max").val();i<=s?t<=s:t>=s;a=i<=s?++t:--t)n.push(Math.abs(a));return r=JSON.stringify(n).replace(/[\[\]']+/g,""),e.attr("data-val",r)},L=function(e){var a;if("accept"===e)a=t.find(".option.accept");else{if("reject"!==e)return(a=t.find('.option[data-val="'+e+'"]')).length?a.attr("data-type"):null;a=t.find(".option.reject")}return a.attr("data-val")},S=function(e){return $(this).parents(".option").addClass("no-hover")},Q=function(e){return $(this).parents(".option").removeClass("no-hover")},V=function(){var e,a,t,n,r,i,s,o,l;if(i=$(".fieldset.phenomena .sentence.selected").attr("data-val")){for(a=$(".option.accept").attr("data-val"),e=JSON.parse("["+a+"]"),l=$(".option.reject").attr("data-val"),o=JSON.parse("["+l+"]"),s=[],t=n=1,5;n<=5;t=++n)e.indexOf(t)>-1?s.push([t,"marker-accepted"]):o.indexOf(t)>-1?s.push([t,"marker-rejected"]):s.push([t,""]);return r={property:i,type:"categorical",stops:s},mapbox.getLayer("markers")?mapbox.setLayoutProperty("markers","icon-image",r):void 0}},y=function(){var e,a,t,n,r,i,s,o,l,d,p,u;if(r={},s=window.location.search.substring(1)){for(l=[],a=t=0,n=(o=(s=decodeURIComponent(s)).split("&")).length;t<n;a=++t)e=(u=(i=o[a].split("="))[0].split("."))[1],p=u[2],d=i[1],"map"===u[0]?(r[e]||(query.map[e]={}),p?l.push(query.map[e][p]=d):l.push(query.map[e]=parseFloat(d))):l.push(void 0);return l}},D=function(){var e,a,t,n,r,o,l,d,p,u,c,f,m,v,g,h,y,b,x,C,w,k;for(f=window.query.map,e=s.find(".sentence.selected"),o=0,p=(y=Object.keys(window.query)).length;o<p;o++)l=y[o],["map","s"].indexOf(l)<0&&delete window.query[l];if(e.length&&(C=e.attr("data-val"),query.s=C),i.is(".mapboxgl-map")&&(t=mapbox.getFilter("markers")))for(n=d=1,b=t.length-1;1<=b?d<=b:d>=b;n=1<=b?++d:--d)if((a=t[n])&&"all"!==a){for(m=j(a[1]),h=[],r=c=2,x=a.length-1;2<=x?c<=x:c>=x;r=2<=x?++c:--c)g=O(m,a[r]),h.push(g);k=h.join(),query[m]?query[m]=query[m]+","+k:query[m]=k}return window.query=Object.assign({map:f},query),v=(v=$.param(window.query)).replace(/\%5B/g,".").replace(/%5D/g,""),w=(u=window.location).origin+u.pathname,t&&(w=w.replace(u.search,"")),w+="?"+v,w=decodeURIComponent(w),history.pushState(h,"",w),J()},J=function(){var e;return e='<iframe width="100%" height="500px" src="'+window.location+'"></iframe>',a.find("textarea").html(e)},b=function(){return y(),query.map&&query.map.id?m():e.addClass("form")},g=function(){var e,a,t,n,r,i,s,o,l,d,p,u;if(o=window.location.search.substring(1)){for(d=!1,e=a=0,n=(l=(o=decodeURIComponent(o)).split("&")).length;a<n;e=++a)if(s=(i=l[e].split("="))[0],u=i[1],"s"===s&&(d=!0,G(u)),A(s),"show"===s&&R(s,u),u=s.indexOf("_")<0?u.split(","):[L(u)],"age"===s)P(s,u);else if("s"!==s)for(t=0,r=u.length;t<r;t++)p=u[t],R(s,p);return d?void 0:G()}},T=function(e){var a,n,r,i,o,l,d,u,c,f,m,v,g,h,y;for(v=s.attr("data-selected"),mapbox.getCanvas().style.cursor="pointer",y=(m=(d=e.features[0]).properties)[v],n=t.find(".option.accept").attr("data-val"),g=t.find(".option.reject").attr("data-val"),n.indexOf(y)>-1?r="#5fa990":g.indexOf(y)>-1&&(r="#795292"),h="<ul>",i=o=0,l=(c=["Age","Gender","Education","Race","Place Raised","Currently Lives","Mother/Guardian 1 Raised","Father/Guardian 2 Raised"]).length;o<l;i=++o)(f=m[p(u=c[i])])&&"NA"!==f&&(h+="<li>"+u+": "+p(f)+"</li>",i>c.length-1&&(description+="</ul>"));return popup.setLngLat(d.geometry.coordinates).setHTML(h).addTo(mapbox),(a=$(popup._content)).parent().addClass("show").attr("data-id",Date.now()),a.css("background",r)},p=function(e){var a;return(a={No_HS_diploma:"Some high school",HS_diploma:"High school",No_degree:"Some college",Associates:"Associate's degree",Bachelors:"Bachelor's degree",Graduate:"Graduate degree","Place Raised":"Raised.CityState","Currently Lives":"Current.CityState","Mother/Guardian 1 Raised":"Mother.CityState","Father/Guardian 2 Raised":"Father.CityState",Asian:"Asian",Black:"Black/African American",Hispanic:"Hispanic/Latino/Latina",Amerindian:"American Indian/Native American",White:"White/Caucasian"})[e]?a[e]:e},W=function(){return mapbox.on("moveend",function(e){var a;return a=mapbox.getCenter(),query.map.zoom=mapbox.getZoom(),query.map.lng=a.lng,query.map.lat=a.lat,D()}),mapbox.on("mouseenter","markers",T),mapbox.on("mouseleave","markers",function(e){var a,t;return a=$(".mapboxgl-popup"),t=a.attr("data-id"),setTimeout(function(){var e;if(e=a.attr("data-id"),t===e)return a.removeClass("show")},500)})},w=function(e){var a,t;return(a=$('.fieldset[data-prop-slug="'+e+'"]'))&&(t=a.attr("data-prop"))?t:e},j=function(e){var a,t;return(a=$('.fieldset[data-prop="'+e+'"]'))&&(t=a.attr("data-prop-slug"))?t:e},I=function(e,a){var t,n,r;return e=w(e),(t=$('.fieldset[data-prop="'+e+'"]')).find(".slider").length?a:((n=t.find('.option[data-val-slug="'+a+'"]'))&&n.length||(n=t.find('.slider[data-val-slug="'+a+'"]')),n.length&&(r=n.attr("data-val")).length?r:a)},O=function(e,a){var t,n,r;return e=j(e),(t=$('.fieldset[data-prop-slug="'+e+'"]')).find(".slider").length?a:(n=t.find('.option[data-val="'+a+'"]')).length&&(r=n.attr("data-val-slug")||n.attr("data-val"))&&r.length?r:a},x(),b(),U(),new ClipboardJS(".instruct, #embed"),$("body").on("click","aside .label",Y),$("body").on("click","aside .multi-label",_),$("body").on("click","aside#filters .option",c),$(".slider").on("slidechange",l),$(".range-input input").on("keyup",z),$(".range-input input").on("change",d),$(".range-input .inputs").on("mouseenter",S),$(".range-input .inputs").on("mouseleave",Q),$("body").on("click","aside .close",K),$("body").on("click","aside#phenomena ul li",f),$("body").on("click","aside#filters .tab",Z),$("body").on("submit","#creation form",M)});